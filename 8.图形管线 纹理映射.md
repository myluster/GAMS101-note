# 图形渲染管线 Graphic Pipeline
图形渲染管线是一个概念上的模型，描述了将三维场景的数学描述（顶点、纹理等）转化为最终屏幕上二维图像所需的一系列步骤。可以将其理解为一个高度优化的**工作流 (Workflow)**，其中大部分步骤都在 GPU 上并行执行
![8.图形管线 纹理映射-1754732736608](image/8.图形管线%20纹理映射-1754732736608.png)
具体顺序：
- **应用阶段 (Application)**
    - **输入**: 场景数据，如三维模型的顶点（包含位置、法线、纹理坐标）、材质、光源、摄像机位置等
    - **处理**: 此阶段在 CPU 上运行，负责准备好所有需要渲染的数据，并将其发送给 GPU
    - **输出**: 准备好的顶点数据和渲染指令
- **顶点处理 (Vertex Processing)**
    - **输入**: 单个的顶点数据
    - **处理**: **此阶段的核心是运行顶点着色器 (Vertex Shader)**。主要工作是将顶点从模型空间变换到裁剪空间（包括模型、视图和投影变换）
    - **输出**: 变换后的顶点流 (Vertex Stream)
- **图元处理 (Triangle Processing)**
    - **输入**: 变换后的顶点流
    - **处理**: 将顶点组合成几何图元（主要是三角形）。此阶段还包括裁剪 (Clipping) 和背面剔除 (Back-face Culling) 等操作
    - **输出**: 图元流 (Triangle Stream)
    - _(注: 几何着色器和细分着色器（如果启用）会在此阶段之后、光栅化之前运行)_
- **光栅化 (Rasterization)**
    - **输入**: 图元流
    - **处理**: 将矢量化的图元（如三角形）转换为屏幕像素网格上的**片元 (Fragments)**。可以理解为判断哪些像素被三角形所覆盖的过程
    - **输出**: 片元流 (Fragment Stream)，每个片元都包含了位置、插值后的法线、纹理坐标等信息
- **片元处理 (Fragment Processing)**
    - **输入**: 单个的片元
    - **处理**: **此阶段的核心是运行片元着色器 (Fragment Shader)**。根据光照模型、纹理采样和其它信息，计算出每个片元的最终颜色
    - **输出**: 带有着色信息的片元 (Shaded Fragments)
- **帧缓冲操作 (Framebuffer Operations)**
    - **输入**: 带有着色信息的片元。
    - **处理**: 将片元的颜色写入帧缓冲区 (Framebuffer)。此阶段会进行深度测试 (Z-testing)、模板测试 (Stencil testing) 和颜色混合 (Blending) 等操作
    - **输出**: 最终显示在屏幕上的图像（像素集合）

# 着色器 Shader
着色器是在 GPU 上运行的一小段程序，它允许开发者在渲染管线的特定阶段自定义图形效果，从而极大地提高了渲染的灵活性和表现力

着色器在图形管线的不同阶段被使用，用于定义图形的外观和效果。主要的着色器类型包括：
## 顶点着色器（Vertex Shader）
作用：处理每个顶点的属性，如位置、法线、纹理坐标和颜色。
功能：
- 对顶点位置进行变换（如模型变换、视图变换、投影变换
- 计算光照模型中的顶点颜色
- 生成或修改纹理坐标
- 将需要的数据传递给后续阶段

运行方式：对传入的每个顶点独立地进行处理。（注意独立）
## 片元着色器（Fragment Shader）（也称为像素着色器）
作用：处理由光栅化阶段生成的每个片元，计算其最终颜色
功能：
- 执行复杂的光照计算（如漫反射、镜面反射、环境光）。
- 进行纹理采样，从纹理中获取颜色或其他数据
- 实现特殊效果（如阴影、反射、透明度、法线贴图）。
运行方式：对每个片元独立地进行处理

## 几何着色器（Geometry Shader）（可选）
作用：在顶点着色器和光栅化阶段之间，处理完整的图元（如三角形）。
功能：
- 可以生成新的顶点或图元
- 改变图元的类型
- 实现如实例化、粒子生成等效果

## 细分着色器（Tessellation Shader）（可选）
作用：细分输入的图元，增加网格的细节
功能：
- 控制几何的细分程度
- 生成更加精细的曲面

## 计算着色器（Compute Shader）
作用：不属于传统图形管线，用于通用计算任务
功能：
- 执行并行计算，如物理模拟、图像处理
- 不直接参与渲染过程

## 学习网址
shadertoy

# 纹理映射
直观来看是将一张二维图贴到三维物体表面上，包含的不仅仅是颜色，还有可以包含更多的信息（法线、高光等），这张二维贴图被称为纹理
关键在于如何建立三维表面点和二维图形上点的一一映射，就要对三维物体表面进行**uv分割**
![8.图形管线 纹理映射-1754732756638](image/8.图形管线%20纹理映射-1754732756638.png)
默认uv都是在0-1之内，不管长宽比

可以将这个过程想象成将一个三维模型“剪开”，并将其所有表面**平铺**在一个二维平面上。这个平铺开的二维版本就是模型的 **UV 贴图**
通过这个过程，三维模型上的每一个**顶点**都被赋予了一个二维坐标，这个坐标就是 **UV 坐标**

从最终渲染的角度来看，我们不需要关心模型具体是如何被‘剪开’的。渲染器只接收并使用已经建立好的‘顶点-UV坐标’的映射关系。这样做实际上有助于纹理的复用
**复用**：一张纹理可以被使用多次




